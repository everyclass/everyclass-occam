# EveryClass-Occam数据库设计

## 数据库表设计

### 学生总表

该表可在每次更新数据时更新，只添加不删除数据

|键名|类型|非空|索引|外键|含义|备注|
|------|-----------|----|-------|----|--------|-----------|
|sid|int|YES|PRIMARY||学生主键|自增|
|code|varchar(45)|YES|UNIQUE||学生学号|code_UNIQUE|
|name|varchar(45)|YES|NO||学生姓名|None|
|klass|varchar(45)|YES|NO||学生班级|None|
|deputy|varchar(45)|YES|NO||所属学院|None|
|campus|varchar(45)|YES|NO||所属校区|None|
||||||||

### 教师总表

该表可在每次更新数据时更新，只添加不删除数据

|键名|类型|非空|索引|外键|含义|备注|
|------|-----------|----|-------|----|--------|-----------|
|tid|int|YES|PRIMARY||教师主键|自增|
|code|varchar(45)|YES|UNIQUE||教师工号|code_UNIQUE|
|name|varchar(45)|YES|NO||教师姓名|None|
|unit|varchar(45)|YES|NO||所属单位|None|
|title|varchar(45)|YES|NO||教师职称|None|
|degree|varchar(45)|YES|NO||教师学历|None|
||||||||

### 教室总表

该表几乎无需更新

|键名|类型|非空|索引|外键|含义|备注|
|--------|-----------|----|-------|----|--------|-----------|
|tid|int|YES|PRIMARY||教室主键|自增|
|code|varchar(45)|YES|UNIQUE||教室工号|code_UNIQUE|
|name|varchar(45)|YES|NO||教室名称|None|
|campus|varchar(45)|YES|NO||所属校区|None|
|building|varchar(45)|YES|NO||教学楼|None|
||||||||

### 学生表

|键名|类型|非空|索引|外键|含义|备注|
|------|-----------|----|----|--------|--------|----|
|sid|int|YES|PRIMARY||学生主键|自增|
|code|varchar(45)|YES|UNIQUE||学生学号|code_UNIQUE|
|name|varchar(45)|YES|INDEX||学生姓名|name_INDEX|
|klass|varchar(45)|YES|NO||学生班级|None|
|deputy|varchar(45)|YES|NO||所属学院|None|
|campus|varchar(45)|YES|NO||所属校区|None|
||||||||

### 教师表

|键名|类型|非空|索引|外键|含义|备注|
|------|-----------|----|----|--------|--------|----|
|tid|int|YES|PRIMARY||教师主键|自增|
|code|varchar(45)|YES|UNIQUE||教师工号|code_UNIQUE|
|name|varchar(45)|YES|INDEX||教师姓名|name_INDEX|
|unit|varchar(45)|YES|NO||所属单位|None|
|title|varchar(45)|YES|NO||教师职称|None|
|degree|varchar(45)|YES|NO||教师学历|None|
||||||||

### 课程表

| 键名    | 类型         | 非空 | 索引    | 外键 | 含义     | 备注        |
| ------- | ------------ | ---- | ------- | ---- | -------- | ----------- |
| cid     | int          | YES  | PRIMARY |      | 课程主键 | 自增        |
| name    | varchar(45)  | YES  | INDEX   |      | 课程名称 | name_INDEX  |
| teacher | varchar(128) | YES  | NO      |      | 上课老师 | None        |
| week    | varchar(128) | YES  | NO      |      | 上课周次 | None        |
| lesson  | varchar(45)  | YES  | NO      |      | 上课节次 | None        |
| room    | varchar(45)  | YES  | NO      |      | 上课教室 | None        |
| klass   | varchar(768) | YES  | NO      |      | 上课班级 | None        |
| pick    | pick(11)     | YES  | NO      |      | 上课人数 | None        |
| hour    | int(11)      | YES  | NO      |      | 上课学时 | None        |
| type    | varchar(45)  | YES  | NO      |      | 上课类型 | None        |
| klassID | varchar(45)  | YES  | UNIQUE  |      | 课程编号 | code_UNIQUE |
| roomID  | varchar(45)  | YES  | NO      |      | 教室编号 | None        |
|         |              |      |         |      |          |             |



## 数据库查询操作

### 查询学生信息

```sql
SELECT `code`, `name`, `klass`, `deputy`, `campus` FROM `student_all`;
```

### 查询教师信息

```sql
SELECT `code`, `name`, `title`, `degree`, `unit` FROM `teacher_all`;
```

### 查询教室信息

查询全部教室

```sql
SELECT `name`, `building`, `campus` FROM `room_all`;
```

查询ABCD座以及世纪楼的教室

```sql
SELECT `name`, `building`, `campus` FROM `room_all` WHERE `building` LIKE '%座' OR `building` LIKE '世%';
```

### 查询学生课表

查询在某学期的课表

```sql
SELECT 
`student`.`code` as student_code, 
`student`.`name` as student_name, 
`student`.`klass` as student_klass, 
`card`.`name` as course_name,
`card`.`week` as course_week,
`card`.`lesson` as course_lesson,
`card`.`room` as course_room,
`card`.`code` as course_code,
`teacher`.`code` as teacher_code,
`teacher`.`name` as teacher_name,
`teacher`.`title` as teacher_title
FROM `student_2018-2019-1` as student
JOIN `student_link_2018-2019-1` as s_link 
ON student.sid = s_link.sid AND student.code = '3901160621'
JOIN `card_2018-2019-1` as card USING(cid)
JOIN `teacher_link_2018-2019-1` as t_link USING(cid)
JOIN `teacher_2018-2019-1` as teacher USING(tid);
```

